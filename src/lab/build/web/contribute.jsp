<%-- 
    Document   : contribute
    Created on : 23 Aug, 2011, 3:00:05 PM
    Author     : root
--%>

<%@page import="java.sql.*"%>
<%@page import="extra.*" %>
<%@page contentType="text/html" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Sample Program contribution for Virtual lab</title>
    </head>
    <body>
    <%
 String exp=(String)session.getAttribute("expNo");
String ws=(String)session.getAttribute("workspace");
 String flag=(String)request.getParameter("flag");
 if(flag!=null){ 
String name=(String)request.getParameter("name");
String email=(String)request.getParameter("email");
String institute=(String)request.getParameter("institute");
String contact=(String)request.getParameter("contact");
//out.println(name+" "+email+" "+institute+" "+contact);
String path=(String)request.getParameter("filecontri");
String description=(String)request.getParameter("description");
String title=(String)request.getParameter("title");
//out.print(path+" "+description+" "+title);
DbConnect db=new DbConnect();
Connection connection = null; 
PreparedStatement  stmt = null;
connection=db.getConnect();
stmt=  connection.prepareStatement("INSERT INTO VirtualLab.ContributeRequests (name,email,institute,contact,filecontri,description ,title) VALUES (?,?,?,?,?,?,?);");
stmt.setString(1, name);
stmt.setString(2, email);
stmt.setString(3, institute);
stmt.setString(4, contact);
stmt.setString(5, path);
stmt.setString(6, description);
stmt.setString(7, title);
int id=0;
stmt.executeUpdate();
ResultSet resultSet = stmt.getGeneratedKeys(); 

if ( resultSet != null && resultSet.next() ) 
{ 
    id=resultSet.getInt(1); 
}
CountUsers cu=new CountUsers();
String fcontent=cu.getContent(path);
out.print("You are successfully added in the Contribute Request's list, You will get an email from Lab Incharge as soon as your request is approved");
String subject=name+" has requested for contribution";
String mail="Dear Sir,\n              This is the notification email regarding the approval of the Sample code contribution request. "
        + name+" requests you to contribute his/her program in the Sample Program list. \n\n"
        + "User Details are as follows: \nName: "+name+"\nEmail: "+email+"\nInstitute: "+institute+"\nContact: "+contact+""
        + "\n\n Program Details are as follows: \n"+"Program: \n"+fcontent+" \n\nTitle: "+title+"\nDescription :"+description+""
               + "\n\n\n     Sir, please evaluate the program and click here http://59.163.223.69:8080/FPGAExp1/approvalPortal.jsp?id="+id+" to approve/reject it. \n\n\nThank You.\n\n\n\nAutogenerated mail,\nPranav Bhole\nLab Developer of Embedded FPGA Virtual Lab\nCOE, PUNE.";
Mails m=new Mails();
m.sendMail(subject, mail);
}else{
%>
        <h3>Thank you for choosing the contribution utility of Virtual Lab</h3>
    
        
        <form name="f" method="post">    
            <table >
                <tr><td><b><u>Benefits of contribution:</u></b></td></tr>
                <tr><td>1. You will be awarded a Certificate of COEP Vitrual Lab as a tribute of your contribution once it is approved by lab in-charge.</td></tr>
                <tr><td>2. Your contributed program will be available to the entire world and enlisted in the sample program tab of simulator.</td></tr>
                <tr><td>3. You will be added in the honorary list of COEP Virtual Lab, we will notify you about the special events/workshops.</td></tr>
                </table><table>
                <tr><td><b><u>Personal details:</u></b></td></tr>
                <tr><td>You full name:</td><td><input type="text" name="name"/></td></tr><br>
                <tr> <td>Email:</td><td><input type="text" name="email"/></td></tr>
                <tr> <td>Institute:</td><td><input type="text" name="institute"/></td></tr>  
                <tr> <td>Contact:</td><td><input type="text" name="contact"/></td></tr>
            </table><table>
                <tr><td><b><u>Program contribution details:</u></b></td></tr>
                <tr>
                    <td> Select your file name <br>to contribute into Virtual Lab: <select name="filecontri">       
<% 

if(ws!=null){
                    CountUsers c=new CountUsers();
                    String p[]=c.files(ws); String temp=".vl";
                    
                    for(int j=0;j<p.length;j++){
                    if(p[j].contains(temp))
                    out.print("<option value=\"/root/Temp/"+ws+"/"+p[j]+"\">"+p[j]+"</option>");

                    }
                    }%>
        </select></td>
        <td>
   Title of the program:<input type="text" name="title" size="30"></input></td>
        <td>
            Description of the Program :<textarea name="description" rows="5" cols="20">
   
   </textarea></td> 
 </tr>
 <br></br>
 
            </table>
        <input type="hidden" name="flag" value="true"></input>
        <center><input type="submit" value="Submit the request for contribution"></input> </center>
        </form>
    <%} %>
    </body>
</html>
